// Copyright 2017 The Procyon Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#include "utf8.h"

#include <string.h>

#define UFFFD_REPLACEMENT_CHARACTER 0xfffd;

static bool is_ascii(uint8_t byte) { return byte < 0200; }
static bool is_continuation(uint8_t byte) { return (0200 <= byte) && (byte < 0300); }
static bool is_header(uint8_t byte) { return (0302 <= byte) && (byte < 0365); }

static size_t continuation_count_for_header(uint8_t byte, uint32_t* rune) {
    if (byte >= 0360) {
        *rune = byte & 0007;
        return 3;
    } else if (byte >= 0340) {
        *rune = byte & 0017;
        return 2;
    } else {
        *rune = byte & 0037;
        return 1;
    }
}

int32_t pn_rune(const char* data, size_t size, size_t index) {
    data += index;
    size -= index;

    if (is_ascii(data[0])) {
        return data[0];
    } else if (!is_header(data[0])) {
        return UFFFD_REPLACEMENT_CHARACTER;
    }
    uint32_t rune;
    size_t   continuation_count = continuation_count_for_header(data[0], &rune);
    if (continuation_count > size) {
        return UFFFD_REPLACEMENT_CHARACTER;
    }
    while (continuation_count-- > 0) {
        if (!is_continuation(*++data)) {
            return UFFFD_REPLACEMENT_CHARACTER;
        }
        rune = (rune << 6) | (*data & 0077);
    }
    if (((0xd800 <= rune) && (rune < 0xe000)) || (0x110000 < rune)) {
        return UFFFD_REPLACEMENT_CHARACTER;
    }
    return rune;
}

size_t pn_rune_next(const char* data, size_t size, size_t index) {
    if (is_header(data[index])) {
        uint8_t h = data[index];
        if (h < 0340) {  // 2 bytes: U+80 ... U+7FF
            if ((index + 1) >= size) {
                return index + 1;  // invalid: unexpected end of string
            }
            uint8_t c[] = {data[index + 1]};
            if (!is_continuation(c[0])) {
                return index + 1;
            }
            return index + 2;
        } else if (h < 0360) {  // 3 bytes: U+800 ... U+D7FF, U+E000 ... U+FFFF
            if ((index + 2) >= size) {
                return index + 1;
            }
            uint8_t c[] = {data[index + 1], data[index + 2]};
            if (((h == 0340) && (c[0] < 0240)) ||   // U+800 ... U+FFF (no overlong encoding)
                ((h == 0355) && (0240 <= c[0])) ||  // U+D000 ... U+D7FF (no surrogate)
                !(is_continuation(c[0]) && is_continuation(c[1]))) {
                return index + 1;
            }
            return index + 3;
        } else {  // 4 bytes: U+40000 ... U+10FFFF
            if ((index + 3) >= size) {
                return index + 1;
            }
            uint8_t c[] = {data[index + 1], data[index + 2], data[index + 3]};
            if (((h == 0360) && (c[0] < 0220)) ||   // U+10000 ... U+3FFFF (no overlong encoding)
                ((h == 0364) && (0220 <= c[0])) ||  // U+100000 ... U+10FFFF (end of code space)
                !(is_continuation(c[0]) && is_continuation(c[1]) && is_continuation(c[2]))) {
                return index + 1;
            }
            return index + 4;
        }
    } else {
        return index + 1;  // default: ASCII or invalid header, so one byte at a time.
    }
}

size_t pn_rune_prev(const char* data, size_t size, size_t index) {
    if ((index >= 4) && (pn_rune_next(data, size, index - 4) == index)) {
        return index - 4;
    } else if ((index >= 3) && (pn_rune_next(data, size, index - 3) == index)) {
        return index - 3;
    } else if ((index >= 2) && (pn_rune_next(data, size, index - 2) == index)) {
        return index - 2;
    } else {
        return index - 1;
    }
}

void pn_chr(uint8_t rune, char* data, size_t* size) {
    if (rune < 0x80) {
        *size = 1;
        *data = rune;
    } else {
        *size = 3;
        memcpy(data, "\357\277\275", 3);
    }
}

void pn_unichr(uint32_t rune, char* data, size_t* size) {
    if (((0xd800 <= rune) && (rune < 0xe000)) || (0x110000 <= rune)) {
        *size = 3;
        memcpy(data, "\357\277\275", 3);
    } else if (rune < 0x80) {
        *size = 1;
        *data = rune;
    } else if (rune < 0x800) {
        *size   = 2;
        data[0] = 0xc0 | (rune >> 6);
        data[1] = 0x80 | ((rune >> 0) & 0x3f);
    } else if (rune < 0x10000) {
        *size   = 3;
        data[0] = 0xe0 | (rune >> 12);
        data[1] = 0x80 | ((rune >> 6) & 0x3f);
        data[2] = 0x80 | ((rune >> 0) & 0x3f);
    } else {
        *size   = 4;
        data[0] = 0xf0 | (rune >> 18);
        data[1] = 0x80 | ((rune >> 12) & 0x3f);
        data[2] = 0x80 | ((rune >> 6) & 0x3f);
        data[3] = 0x80 | ((rune >> 0) & 0x3f);
    }
}

static const int8_t widths_0[][8] = {
        [0] = {-1, -1, -1, -1, -1, -1, -1, -1},  [1] = {-1, -1, -1, -1, -1, -1, -1, 0},
        [2] = {-1, -1, -1, -1, -1, -1, -1, 1},   [3] = {-1, -1, -1, -1, -1, -1, 0, 0},
        [4] = {-1, -1, -1, -1, -1, -1, 1, -1},   [5] = {-1, -1, -1, -1, -1, -1, 1, 1},
        [6] = {-1, -1, -1, -1, -1, 0, 0, -1},    [7] = {-1, -1, -1, -1, -1, 1, -1, -1},
        [8] = {-1, -1, -1, -1, -1, 1, 0, 1},     [9] = {-1, -1, -1, -1, -1, 1, 1, 1},
        [10] = {-1, -1, -1, -1, -1, 2, 2, 2},    [11] = {-1, -1, -1, -1, 0, 0, 0, 0},
        [12] = {-1, -1, -1, -1, 1, 1, -1, -1},   [13] = {-1, -1, -1, -1, 1, 1, -1, 1},
        [14] = {-1, -1, -1, -1, 1, 1, 1, 0},     [15] = {-1, -1, -1, -1, 1, 1, 1, 1},
        [16] = {-1, -1, -1, 0, 0, 0, 0, 0},      [17] = {-1, -1, -1, 1, 1, -1, -1, -1},
        [18] = {-1, -1, -1, 1, 1, 1, 1, 1},      [19] = {-1, -1, 0, -1, -1, -1, -1, 0},
        [20] = {-1, -1, 0, -1, 0, 0, -1, 0},     [21] = {-1, -1, 0, 0, -1, 1, 1, 1},
        [22] = {-1, -1, 0, 0, 0, 0, 0, 0},       [23] = {-1, -1, 0, 0, 1, -1, -1, -1},
        [24] = {-1, -1, 0, 1, -1, 1, 1, 1},      [25] = {-1, -1, 1, -1, -1, -1, -1, 1},
        [26] = {-1, -1, 1, -1, -1, 1, 1, -1},    [27] = {-1, -1, 1, 1, -1, 1, 1, 1},
        [28] = {-1, -1, 1, 1, 1, -1, -1, -1},    [29] = {-1, -1, 1, 1, 1, -1, 1, 1},
        [30] = {-1, -1, 1, 1, 1, 1, 1, 1},       [31] = {-1, -1, 2, -1, 2, 2, 2, 2},
        [32] = {-1, 0, -1, -1, -1, -1, -1, -1},  [33] = {-1, 0, 0, 0, -1, 1, 1, 1},
        [34] = {-1, 0, 0, 0, 0, 0, 0, 0},        [35] = {-1, 0, 0, 2, 2, 2, 2, 2},
        [36] = {-1, 1, -1, 1, -1, -1, -1, -1},   [37] = {-1, 1, -1, 1, -1, 1, -1, 1},
        [38] = {-1, 1, -1, 1, -1, 1, 1, 1},      [39] = {-1, 1, 0, 0, 0, 0, 0, 0},
        [40] = {-1, 1, 1, -1, -1, -1, -1, -1},   [41] = {-1, 1, 1, -1, 1, -1, -1, 1},
        [42] = {-1, 1, 1, -1, 1, -1, 1, 1},      [43] = {-1, 1, 1, 1, -1, 1, -1, 1},
        [44] = {-1, 1, 1, 1, -1, 1, 1, 1},       [45] = {-1, 1, 1, 1, 1, -1, -1, -1},
        [46] = {-1, 1, 1, 1, 1, -1, 1, -1},      [47] = {-1, 1, 1, 1, 1, -1, 1, 1},
        [48] = {-1, 1, 1, 1, 1, 1, 1, -1},       [49] = {-1, 1, 1, 1, 1, 1, 1, 1},
        [50] = {-1, 2, 2, 2, 2, 2, 2, 2},        [51] = {0, -1, -1, -1, -1, -1, -1, -1},
        [52] = {0, -1, -1, 0, 0, 0, -1, -1},     [53] = {0, -1, -1, 0, 0, 0, 0, 0},
        [54] = {0, -1, -1, 0, 0, 0, 1, -1},      [55] = {0, -1, 0, 0, 0, 0, -1, -1},
        [56] = {0, -1, 0, 0, 0, 0, 1, 1},        [57] = {0, 0, -1, -1, -1, -1, -1, -1},
        [58] = {0, 0, -1, 0, 0, -1, 0, 0},       [59] = {0, 0, -1, 0, 0, 0, -1, -1},
        [60] = {0, 0, -1, 0, 0, 0, 0, 0},        [61] = {0, 0, -1, 0, 0, 1, -1, -1},
        [62] = {0, 0, 0, -1, -1, -1, -1, -1},    [63] = {0, 0, 0, -1, -1, -1, -1, 0},
        [64] = {0, 0, 0, -1, -1, -1, -1, 1},     [65] = {0, 0, 0, -1, -1, -1, 0, 0},
        [66] = {0, 0, 0, -1, -1, 1, 1, 1},       [67] = {0, 0, 0, 0, -1, -1, -1, -1},
        [68] = {0, 0, 0, 0, -1, -1, 1, 1},       [69] = {0, 0, 0, 0, -1, 1, 1, 1},
        [70] = {0, 0, 0, 0, 0, -1, -1, -1},      [71] = {0, 0, 0, 0, 0, -1, -1, 0},
        [72] = {0, 0, 0, 0, 0, -1, 0, -1},       [73] = {0, 0, 0, 0, 0, -1, 0, 0},
        [74] = {0, 0, 0, 0, 0, -1, 1, 0},        [75] = {0, 0, 0, 0, 0, -1, 1, 1},
        [76] = {0, 0, 0, 0, 0, 0, -1, -1},       [77] = {0, 0, 0, 0, 0, 0, -1, 0},
        [78] = {0, 0, 0, 0, 0, 0, 0, -1},        [79] = {0, 0, 0, 0, 0, 0, 0, 0},
        [80] = {0, 0, 0, 0, 0, 0, 0, 1},         [81] = {0, 0, 0, 0, 0, 0, 1, 0},
        [82] = {0, 0, 0, 0, 0, 0, 1, 1},         [83] = {0, 0, 0, 0, 0, 1, -1, -1},
        [84] = {0, 0, 0, 0, 0, 1, 0, 0},         [85] = {0, 0, 0, 0, 0, 1, 1, 0},
        [86] = {0, 0, 0, 0, 0, 1, 1, 1},         [87] = {0, 0, 0, 0, 1, 0, 0, 0},
        [88] = {0, 0, 0, 0, 1, 1, 1, 1},         [89] = {0, 0, 0, 1, -1, -1, -1, -1},
        [90] = {0, 0, 0, 1, -1, -1, 1, 1},       [91] = {0, 0, 0, 1, 0, 0, -1, -1},
        [92] = {0, 0, 0, 1, 0, 0, 0, 0},         [93] = {0, 0, 0, 1, 1, -1, 1, 1},
        [94] = {0, 0, 0, 1, 1, 0, 0, 0},         [95] = {0, 0, 0, 1, 1, 1, 1, 1},
        [96] = {0, 0, 1, 0, 0, 0, 0, 0},         [97] = {0, 0, 1, 0, 0, 0, 0, 1},
        [98] = {0, 0, 1, 1, -1, -1, -1, -1},     [99] = {0, 0, 1, 1, 1, 0, 0, 0},
        [100] = {0, 0, 1, 1, 1, 0, 1, -1},       [101] = {0, 0, 1, 1, 1, 1, 0, 0},
        [102] = {0, 0, 1, 1, 1, 1, 1, 1},        [103] = {0, 1, -1, -1, -1, -1, -1, -1},
        [104] = {0, 1, 0, 0, 0, 0, 1, 1},        [105] = {0, 1, 0, 0, 0, 1, 1, 0},
        [106] = {0, 1, 1, 1, 1, -1, -1, -1},     [107] = {0, 1, 1, 1, 1, 0, 1, 1},
        [108] = {0, 1, 1, 1, 1, 1, 0, 0},        [109] = {0, 1, 1, 1, 1, 1, 1, 1},
        [110] = {1, -1, -1, -1, -1, -1, -1, -1}, [111] = {1, -1, -1, -1, -1, -1, -1, 0},
        [112] = {1, -1, -1, -1, 1, -1, -1, 1},   [113] = {1, -1, -1, -1, 1, 1, 1, 1},
        [114] = {1, -1, -1, 1, 1, 1, 1, 1},      [115] = {1, -1, 0, 0, -1, -1, -1, -1},
        [116] = {1, -1, 1, -1, -1, -1, 1, 1},    [117] = {1, -1, 1, -1, -1, 1, -1, -1},
        [118] = {1, -1, 1, 1, -1, 1, 1, -1},     [119] = {1, -1, 1, 1, -1, 1, 1, 1},
        [120] = {1, -1, 1, 1, 1, 1, -1, -1},     [121] = {1, -1, 1, 1, 1, 1, -1, 1},
        [122] = {1, -1, 1, 1, 1, 1, 1, 1},       [123] = {1, 0, 0, 0, -1, -1, 1, -1},
        [124] = {1, 0, 0, 0, -1, 0, 0, -1},      [125] = {1, 0, 0, 0, -1, 1, 1, 1},
        [126] = {1, 0, 0, 0, 0, 0, -1, -1},      [127] = {1, 0, 0, 0, 0, 0, 0, -1},
        [128] = {1, 0, 0, 0, 0, 0, 0, 0},        [129] = {1, 0, 0, 0, 0, 1, -1, -1},
        [130] = {1, 0, 0, 0, 0, 1, 1, 1},        [131] = {1, 0, 0, 0, 1, 1, 1, 1},
        [132] = {1, 0, 0, 1, 0, 0, 1, 0},        [133] = {1, 0, 1, -1, -1, -1, -1, -1},
        [134] = {1, 0, 1, 1, 0, 0, 0, 0},        [135] = {1, 0, 1, 1, 1, 1, 0, 0},
        [136] = {1, 0, 1, 1, 1, 1, 1, 1},        [137] = {1, 1, -1, -1, -1, -1, -1, -1},
        [138] = {1, 1, -1, -1, -1, -1, -1, 1},   [139] = {1, 1, -1, -1, -1, -1, 0, 0},
        [140] = {1, 1, -1, -1, -1, -1, 1, 1},    [141] = {1, 1, -1, -1, -1, 1, 0, 0},
        [142] = {1, 1, -1, -1, -1, 1, 1, 1},     [143] = {1, 1, -1, -1, 0, -1, 0, 0},
        [144] = {1, 1, -1, -1, 0, 1, 0, 0},      [145] = {1, 1, -1, -1, 1, 0, 0, 1},
        [146] = {1, 1, -1, -1, 1, 1, 1, 1},      [147] = {1, 1, -1, 0, 0, 1, 0, 0},
        [148] = {1, 1, -1, 1, -1, 1, 0, -1},     [149] = {1, 1, -1, 1, -1, 1, 1, 1},
        [150] = {1, 1, -1, 1, 1, -1, 1, 1},      [151] = {1, 1, -1, 1, 1, 1, 1, -1},
        [152] = {1, 1, -1, 1, 1, 1, 1, 1},       [153] = {1, 1, 0, 0, -1, -1, -1, -1},
        [154] = {1, 1, 0, 0, -1, -1, 0, 0},      [155] = {1, 1, 0, 0, -1, -1, 1, 1},
        [156] = {1, 1, 0, 0, 0, -1, -1, -1},     [157] = {1, 1, 0, 0, 0, 0, 0, -1},
        [158] = {1, 1, 0, 0, 0, 0, 0, 0},        [159] = {1, 1, 0, 0, 0, 0, 1, 1},
        [160] = {1, 1, 0, 0, 0, 1, -1, -1},      [161] = {1, 1, 0, 0, 0, 1, 0, 0},
        [162] = {1, 1, 0, 0, 0, 1, 1, -1},       [163] = {1, 1, 0, 0, 0, 1, 1, 0},
        [164] = {1, 1, 0, 0, 1, 1, 1, 1},        [165] = {1, 1, 0, 1, 1, 1, 0, 1},
        [166] = {1, 1, 1, -1, -1, -1, -1, -1},   [167] = {1, 1, 1, -1, -1, -1, -1, 1},
        [168] = {1, 1, 1, -1, -1, -1, 1, 1},     [169] = {1, 1, 1, -1, -1, 0, 0, 0},
        [170] = {1, 1, 1, -1, -1, 0, 1, 1},      [171] = {1, 1, 1, -1, -1, 1, 1, 1},
        [172] = {1, 1, 1, -1, 1, -1, 1, 1},      [173] = {1, 1, 1, -1, 1, 1, -1, -1},
        [174] = {1, 1, 1, -1, 1, 1, -1, 1},      [175] = {1, 1, 1, -1, 1, 1, 1, 1},
        [176] = {1, 1, 1, 0, 0, 0, -1, -1},      [177] = {1, 1, 1, 0, 0, 0, 0, 0},
        [178] = {1, 1, 1, 0, 0, 0, 0, 1},        [179] = {1, 1, 1, 0, 0, 0, 1, 1},
        [180] = {1, 1, 1, 0, 0, 1, 0, 0},        [181] = {1, 1, 1, 0, 1, 1, 1, -1},
        [182] = {1, 1, 1, 0, 1, 1, 1, 1},        [183] = {1, 1, 1, 1, -1, -1, -1, -1},
        [184] = {1, 1, 1, 1, -1, -1, -1, 1},     [185] = {1, 1, 1, 1, -1, -1, 1, 1},
        [186] = {1, 1, 1, 1, -1, 1, -1, -1},     [187] = {1, 1, 1, 1, -1, 1, 1, 1},
        [188] = {1, 1, 1, 1, 0, 0, -1, -1},      [189] = {1, 1, 1, 1, 0, 0, 0, 0},
        [190] = {1, 1, 1, 1, 0, 1, 1, 1},        [191] = {1, 1, 1, 1, 1, -1, -1, -1},
        [192] = {1, 1, 1, 1, 1, -1, -1, 1},      [193] = {1, 1, 1, 1, 1, -1, 1, -1},
        [194] = {1, 1, 1, 1, 1, -1, 1, 1},       [195] = {1, 1, 1, 1, 1, 0, -1, -1},
        [196] = {1, 1, 1, 1, 1, 0, 0, -1},       [197] = {1, 1, 1, 1, 1, 0, 0, 0},
        [198] = {1, 1, 1, 1, 1, 0, 0, 1},        [199] = {1, 1, 1, 1, 1, 0, 1, 0},
        [200] = {1, 1, 1, 1, 1, 0, 1, 1},        [201] = {1, 1, 1, 1, 1, 1, -1, -1},
        [202] = {1, 1, 1, 1, 1, 1, -1, 1},       [203] = {1, 1, 1, 1, 1, 1, 0, -1},
        [204] = {1, 1, 1, 1, 1, 1, 0, 0},        [205] = {1, 1, 1, 1, 1, 1, 0, 1},
        [206] = {1, 1, 1, 1, 1, 1, 1, -1},       [207] = {1, 1, 1, 1, 1, 1, 1, 0},
        [208] = {1, 1, 1, 1, 1, 1, 1, 1},        [209] = {1, 1, 1, 1, 1, 1, 1, 2},
        [210] = {1, 1, 1, 1, 1, 1, 2, 1},        [211] = {1, 1, 1, 1, 1, 2, 1, 1},
        [212] = {1, 1, 1, 1, 1, 2, 2, 1},        [213] = {1, 1, 1, 1, 1, 2, 2, 2},
        [214] = {1, 1, 1, 1, 2, 1, 1, 1},        [215] = {1, 1, 1, 1, 2, 1, 2, 1},
        [216] = {1, 1, 1, 1, 2, 2, 1, 1},        [217] = {1, 1, 1, 1, 2, 2, 2, 2},
        [218] = {1, 1, 1, 2, 1, 1, 1, 1},        [219] = {1, 1, 1, 2, 2, -1, -1, -1},
        [220] = {1, 1, 1, 2, 2, 1, 1, 1},        [221] = {1, 1, 1, 2, 2, 2, 1, 2},
        [222] = {1, 1, 1, 2, 2, 2, 2, 1},        [223] = {1, 1, 1, 2, 2, 2, 2, 2},
        [224] = {1, 1, 2, 1, 1, 1, 1, 1},        [225] = {1, 1, 2, 1, 1, 2, 1, 1},
        [226] = {1, 1, 2, 2, 1, 1, 1, 1},        [227] = {1, 1, 2, 2, 1, 2, 1, 1},
        [228] = {1, 2, 1, 1, 1, 1, 1, 1},        [229] = {1, 2, 2, 1, 1, 1, 1, 1},
        [230] = {1, 2, 2, 2, 2, 1, 1, 1},        [231] = {1, 2, 2, 2, 2, 2, 2, 2},
        [232] = {2, -1, -1, -1, -1, -1, -1, -1}, [233] = {2, -1, -1, 2, 2, 2, 2, -1},
        [234] = {2, 1, 1, 1, 1, 1, 1, 1},        [235] = {2, 1, 1, 1, 1, 2, 1, 1},
        [236] = {2, 1, 1, 1, 2, 1, 1, 1},        [237] = {2, 1, 1, 2, 1, 1, 1, 1},
        [238] = {2, 1, 2, 2, 2, 2, 2, 2},        [239] = {2, 2, -1, -1, -1, -1, -1, -1},
        [240] = {2, 2, -1, 2, 2, 2, 2, 2},       [241] = {2, 2, 0, 0, 0, 0, 0, 0},
        [242] = {2, 2, 2, -1, -1, -1, -1, -1},   [243] = {2, 2, 2, -1, 2, 2, 2, 2},
        [244] = {2, 2, 2, 1, 1, -1, -1, -1},     [245] = {2, 2, 2, 1, 1, 1, 1, 1},
        [246] = {2, 2, 2, 1, 1, 1, 1, 2},        [247] = {2, 2, 2, 2, -1, -1, -1, -1},
        [248] = {2, 2, 2, 2, 1, 1, 1, 1},        [249] = {2, 2, 2, 2, 2, -1, -1, -1},
        [250] = {2, 2, 2, 2, 2, 1, 1, 2},        [251] = {2, 2, 2, 2, 2, 1, 2, 2},
        [252] = {2, 2, 2, 2, 2, 2, -1, -1},      [253] = {2, 2, 2, 2, 2, 2, 1, 1},
        [254] = {2, 2, 2, 2, 2, 2, 1, 2},        [255] = {2, 2, 2, 2, 2, 2, 2, -1},
        [256] = {2, 2, 2, 2, 2, 2, 2, 1},        [257] = {2, 2, 2, 2, 2, 2, 2, 2},
};
static const uint16_t widths_1[][8] = {
        [0]   = {0, 0, 0, 0, 0, 0, 0, 0},
        [1]   = {0, 0, 0, 0, 0, 0, 2, 208},
        [2]   = {0, 0, 0, 0, 0, 0, 49, 208},
        [3]   = {0, 0, 0, 0, 0, 0, 137, 0},
        [4]   = {0, 0, 0, 0, 0, 0, 257, 257},
        [5]   = {0, 0, 0, 0, 5, 208, 208, 208},
        [6]   = {0, 0, 0, 0, 49, 194, 208, 208},
        [7]   = {0, 0, 0, 0, 208, 201, 0, 0},
        [8]   = {0, 0, 0, 0, 208, 208, 173, 18},
        [9]   = {0, 0, 0, 0, 208, 208, 178, 110},
        [10]  = {0, 0, 0, 0, 208, 208, 183, 0},
        [11]  = {0, 0, 0, 0, 208, 208, 194, 201},
        [12]  = {0, 0, 0, 0, 208, 208, 208, 206},
        [13]  = {0, 0, 0, 0, 208, 208, 208, 208},
        [14]  = {0, 0, 0, 0, 239, 0, 0, 0},
        [15]  = {0, 0, 16, 79, 60, 79, 79, 79},
        [16]  = {0, 0, 79, 79, 79, 79, 51, 0},
        [17]  = {0, 0, 208, 208, 208, 0, 208, 208},
        [18]  = {0, 0, 208, 208, 208, 201, 83, 0},
        [19]  = {0, 0, 208, 208, 208, 208, 208, 195},
        [20]  = {0, 0, 208, 208, 208, 208, 208, 208},
        [21]  = {0, 1, 95, 208, 0, 0, 0, 0},
        [22]  = {5, 208, 79, 90, 208, 208, 208, 208},
        [23]  = {10, 257, 257, 257, 257, 257, 50, 257},
        [24]  = {15, 172, 208, 208, 152, 208, 208, 208},
        [25]  = {21, 208, 206, 30, 208, 208, 152, 186},
        [26]  = {24, 168, 120, 42, 17, 168, 208, 139},
        [27]  = {25, 38, 41, 37, 41, 175, 175, 46},
        [28]  = {30, 30, 30, 28, 255, 206, 0, 12},
        [29]  = {33, 167, 114, 208, 208, 122, 118, 143},
        [30]  = {33, 192, 114, 208, 208, 122, 119, 144},
        [31]  = {33, 202, 152, 208, 208, 122, 119, 144},
        [32]  = {41, 117, 15, 49, 43, 27, 134, 61},
        [33]  = {48, 48, 48, 0, 206, 206, 208, 208},
        [34]  = {49, 208, 208, 191, 208, 208, 208, 208},
        [35]  = {49, 208, 208, 208, 208, 208, 134, 64},
        [36]  = {49, 209, 49, 208, 208, 208, 201, 0},
        [37]  = {50, 257, 257, 257, 257, 257, 257, 257},
        [38]  = {63, 52, 32, 46, 5, 208, 100, 0},
        [39]  = {65, 55, 111, 0, 5, 208, 208, 166},
        [40]  = {69, 192, 114, 208, 208, 122, 119, 147},
        [41]  = {69, 194, 122, 208, 208, 208, 208, 180},
        [42]  = {71, 52, 3, 13, 155, 208, 208, 0},
        [43]  = {71, 52, 111, 9, 154, 70, 70, 0},
        [44]  = {71, 54, 1, 13, 155, 208, 208, 203},
        [45]  = {73, 55, 6, 4, 155, 208, 40, 0},
        [46]  = {73, 55, 6, 166, 155, 208, 0, 208},
        [47]  = {73, 56, 14, 208, 155, 208, 208, 208},
        [48]  = {76, 5, 208, 137, 79, 79, 102, 207},
        [49]  = {77, 59, 110, 0, 155, 208, 137, 39},
        [50]  = {78, 79, 79, 53, 58, 62, 0, 0},
        [51]  = {79, 66, 208, 208, 208, 208, 208, 208},
        [52]  = {79, 79, 79, 79, 79, 79, 0, 0},
        [53]  = {79, 79, 79, 79, 79, 79, 79, 60},
        [54]  = {79, 79, 79, 79, 79, 79, 79, 79},
        [55]  = {79, 79, 79, 79, 79, 79, 80, 177},
        [56]  = {79, 79, 79, 79, 79, 79, 208, 30},
        [57]  = {79, 79, 79, 79, 79, 86, 200, 208},
        [58]  = {79, 79, 88, 195, 208, 137, 208, 137},
        [59]  = {79, 79, 128, 208, 164, 208, 208, 208},
        [60]  = {79, 79, 257, 239, 79, 79, 257, 257},
        [61]  = {80, 201, 30, 208, 208, 208, 0, 1},
        [62]  = {80, 208, 208, 148, 0, 0, 0, 0},
        [63]  = {81, 0, 208, 137, 202, 122, 208, 208},
        [64]  = {84, 197, 79, 34, 79, 79, 79, 75},
        [65]  = {86, 183, 208, 208, 208, 177, 88, 191},
        [66]  = {86, 194, 122, 208, 208, 122, 208, 141},
        [67]  = {86, 208, 208, 208, 208, 208, 189, 79},
        [68]  = {88, 0, 208, 137, 0, 0, 0, 0},
        [69]  = {88, 208, 208, 208, 208, 208, 177, 79},
        [70]  = {88, 208, 208, 208, 208, 208, 208, 161},
        [71]  = {94, 88, 208, 208, 208, 159, 208, 208},
        [72]  = {95, 208, 208, 208, 128, 82, 208, 208},
        [73]  = {95, 208, 208, 208, 207, 79, 75, 208},
        [74]  = {95, 208, 208, 208, 208, 208, 79, 93},
        [75]  = {95, 208, 208, 208, 208, 208, 177, 79},
        [76]  = {95, 208, 208, 208, 208, 208, 208, 79},
        [77]  = {102, 208, 208, 208, 208, 208, 189, 79},
        [78]  = {106, 0, 208, 137, 208, 191, 0, 0},
        [79]  = {109, 129, 208, 208, 49, 208, 191, 0},
        [80]  = {109, 202, 208, 140, 200, 208, 208, 206},
        [81]  = {109, 208, 208, 188, 0, 0, 0, 0},
        [82]  = {113, 208, 208, 208, 208, 201, 191, 0},
        [83]  = {120, 208, 206, 208, 208, 208, 208, 208},
        [84]  = {124, 11, 187, 49, 208, 208, 201, 63},
        [85]  = {125, 192, 114, 208, 208, 122, 116, 144},
        [86]  = {128, 95, 208, 208, 208, 208, 177, 97},
        [87]  = {131, 194, 122, 208, 208, 122, 187, 144},
        [88]  = {132, 0, 208, 208, 208, 167, 191, 0},
        [89]  = {133, 0, 0, 18, 208, 177, 196, 0},
        [90]  = {137, 0, 18, 208, 208, 208, 208, 208},
        [91]  = {137, 0, 208, 208, 208, 110, 208, 137},
        [92]  = {150, 208, 208, 208, 208, 208, 208, 208},
        [93]  = {158, 81, 208, 159, 208, 208, 208, 208},
        [94]  = {160, 0, 0, 0, 0, 0, 0, 0},
        [95]  = {165, 182, 208, 208, 177, 183, 208, 137},
        [96]  = {167, 208, 208, 208, 208, 208, 184, 208},
        [97]  = {177, 102, 208, 208, 208, 208, 208, 208},
        [98]  = {182, 188, 208, 146, 208, 208, 208, 179},
        [99]  = {183, 0, 0, 0, 0, 0, 0, 0},
        [100] = {183, 208, 201, 0, 0, 0, 0, 0},
        [101] = {185, 158, 79, 102, 166, 0, 0, 0},
        [102] = {187, 208, 208, 208, 41, 49, 175, 36},
        [103] = {187, 208, 208, 208, 208, 208, 208, 208},
        [104] = {189, 62, 208, 140, 0, 0, 0, 0},
        [105] = {190, 183, 0, 16, 34, 79, 0, 0},
        [106] = {191, 0, 128, 79, 79, 79, 79, 78},
        [107] = {192, 208, 78, 0, 0, 0, 0, 0},
        [108] = {193, 30, 122, 208, 208, 208, 208, 208},
        [109] = {193, 76, 208, 146, 0, 0, 0, 0},
        [110] = {194, 208, 185, 187, 208, 208, 29, 206},
        [111] = {196, 0, 208, 208, 208, 208, 181, 0},
        [112] = {198, 208, 208, 208, 208, 133, 208, 208},
        [113] = {201, 0, 208, 152, 152, 208, 208, 9},
        [114] = {201, 0, 208, 208, 208, 191, 208, 208},
        [115] = {201, 122, 208, 208, 208, 208, 202, 112},
        [116] = {201, 201, 208, 37, 208, 208, 208, 201},
        [117] = {202, 7, 208, 208, 208, 208, 208, 208},
        [118] = {202, 171, 194, 194, 208, 208, 208, 151},
        [119] = {204, 79, 109, 137, 0, 0, 0, 0},
        [120] = {205, 194, 208, 166, 0, 0, 0, 0},
        [121] = {206, 0, 0, 0, 0, 0, 0, 0},
        [122] = {206, 0, 18, 8, 208, 208, 206, 193},
        [123] = {206, 18, 208, 208, 208, 208, 208, 183},
        [124] = {206, 19, 72, 79, 5, 208, 23, 0},
        [125] = {206, 121, 208, 202, 208, 137, 208, 208},
        [126] = {206, 152, 208, 208, 208, 208, 127, 20},
        [127] = {206, 206, 206, 206, 79, 79, 79, 79},
        [128] = {207, 0, 128, 88, 208, 208, 208, 208},
        [129] = {207, 79, 67, 2, 257, 257, 257, 249},
        [130] = {207, 80, 208, 183, 0, 0, 0, 0},
        [131] = {208, 0, 0, 0, 0, 0, 208, 201},
        [132] = {208, 0, 92, 79, 79, 107, 163, 57},
        [133] = {208, 0, 208, 137, 208, 208, 208, 208},
        [134] = {208, 0, 208, 208, 208, 201, 0, 0},
        [135] = {208, 49, 208, 208, 208, 191, 34, 79},
        [136] = {208, 110, 0, 0, 0, 0, 0, 0},
        [137] = {208, 110, 208, 110, 208, 208, 208, 208},
        [138] = {208, 110, 208, 145, 0, 0, 0, 0},
        [139] = {208, 110, 208, 208, 208, 208, 208, 171},
        [140] = {208, 120, 206, 120, 208, 208, 208, 208},
        [141] = {208, 120, 208, 208, 208, 208, 120, 206},
        [142] = {208, 122, 208, 208, 208, 207, 78, 79},
        [143] = {208, 122, 208, 208, 208, 208, 208, 206},
        [144] = {208, 137, 0, 0, 0, 0, 0, 0},
        [145] = {208, 137, 208, 137, 208, 201, 79, 78},
        [146] = {208, 137, 208, 168, 208, 208, 208, 208},
        [147] = {208, 142, 208, 208, 208, 208, 208, 208},
        [148] = {208, 152, 208, 183, 44, 152, 208, 183},
        [149] = {208, 157, 60, 110, 208, 137, 0, 0},
        [150] = {208, 166, 0, 0, 208, 208, 208, 208},
        [151] = {208, 166, 208, 208, 208, 208, 204, 62},
        [152] = {208, 171, 34, 79, 79, 79, 79, 81},
        [153] = {208, 176, 208, 137, 208, 208, 208, 208},
        [154] = {208, 177, 79, 79, 208, 208, 109, 208},
        [155] = {208, 183, 208, 208, 208, 208, 208, 208},
        [156] = {208, 183, 257, 257, 257, 257, 257, 255},
        [157] = {208, 185, 208, 208, 208, 208, 208, 208},
        [158] = {208, 187, 208, 208, 206, 208, 208, 174},
        [159] = {208, 191, 208, 208, 208, 208, 208, 208},
        [160] = {208, 194, 156, 0, 208, 208, 162, 0},
        [161] = {208, 201, 136, 208, 208, 208, 79, 79},
        [162] = {208, 201, 208, 201, 0, 0, 0, 0},
        [163] = {208, 206, 0, 0, 0, 0, 0, 0},
        [164] = {208, 206, 208, 183, 110, 0, 0, 0},
        [165] = {208, 206, 208, 191, 208, 208, 208, 208},
        [166] = {208, 208, 0, 0, 0, 0, 0, 0},
        [167] = {208, 208, 22, 79, 79, 34, 78, 0},
        [168] = {208, 208, 30, 208, 208, 208, 208, 208},
        [169] = {208, 208, 110, 0, 109, 208, 208, 183},
        [170] = {208, 208, 120, 208, 208, 208, 208, 208},
        [171] = {208, 208, 137, 45, 0, 49, 0, 0},
        [172] = {208, 208, 152, 208, 208, 189, 79, 203},
        [173] = {208, 208, 153, 0, 208, 194, 115, 0},
        [174] = {208, 208, 183, 0, 208, 206, 49, 208},
        [175] = {208, 208, 183, 208, 208, 208, 208, 183},
        [176] = {208, 208, 194, 208, 208, 208, 208, 208},
        [177] = {208, 208, 197, 78, 79, 79, 79, 71},
        [178] = {208, 208, 201, 0, 208, 0, 0, 0},
        [179] = {208, 208, 201, 201, 208, 208, 208, 208},
        [180] = {208, 208, 201, 208, 208, 208, 166, 208},
        [181] = {208, 208, 201, 208, 208, 208, 208, 208},
        [182] = {208, 208, 202, 208, 208, 208, 208, 208},
        [183] = {208, 208, 204, 74, 85, 104, 208, 208},
        [184] = {208, 208, 204, 96, 87, 126, 208, 206},
        [185] = {208, 208, 204, 101, 105, 82, 130, 208},
        [186] = {208, 208, 206, 0, 206, 206, 206, 206},
        [187] = {208, 208, 206, 0, 208, 208, 208, 110},
        [188] = {208, 208, 206, 49, 208, 208, 208, 208},
        [189] = {208, 208, 207, 68, 208, 208, 208, 208},
        [190] = {208, 208, 208, 102, 208, 208, 199, 135},
        [191] = {208, 208, 208, 110, 0, 0, 0, 0},
        [192] = {208, 208, 208, 123, 208, 166, 0, 0},
        [193] = {208, 208, 208, 137, 0, 0, 0, 0},
        [194] = {208, 208, 208, 137, 208, 208, 208, 208},
        [195] = {208, 208, 208, 166, 0, 0, 0, 0},
        [196] = {208, 208, 208, 169, 79, 67, 208, 208},
        [197] = {208, 208, 208, 169, 208, 208, 208, 191},
        [198] = {208, 208, 208, 184, 208, 208, 208, 138},
        [199] = {208, 208, 208, 191, 208, 208, 208, 208},
        [200] = {208, 208, 208, 194, 26, 47, 208, 149},
        [201] = {208, 208, 208, 201, 208, 137, 208, 208},
        [202] = {208, 208, 208, 202, 208, 208, 208, 208},
        [203] = {208, 208, 208, 204, 208, 208, 208, 208},
        [204] = {208, 208, 208, 206, 0, 0, 146, 208},
        [205] = {208, 208, 208, 206, 2, 208, 0, 0},
        [206] = {208, 208, 208, 206, 79, 67, 79, 67},
        [207] = {208, 208, 208, 206, 208, 140, 0, 0},
        [208] = {208, 208, 208, 206, 208, 208, 208, 208},
        [209] = {208, 208, 208, 207, 79, 62, 208, 137},
        [210] = {208, 208, 208, 208, 0, 0, 0, 0},
        [211] = {208, 208, 208, 208, 177, 91, 208, 137},
        [212] = {208, 208, 208, 208, 183, 2, 0, 0},
        [213] = {208, 208, 208, 208, 183, 9, 208, 208},
        [214] = {208, 208, 208, 208, 189, 0, 208, 137},
        [215] = {208, 208, 208, 208, 189, 79, 79, 18},
        [216] = {208, 208, 208, 208, 196, 18, 206, 0},
        [217] = {208, 208, 208, 208, 197, 99, 62, 16},
        [218] = {208, 208, 208, 208, 201, 0, 208, 208},
        [219] = {208, 208, 208, 208, 201, 208, 208, 208},
        [220] = {208, 208, 208, 208, 202, 7, 208, 208},
        [221] = {208, 208, 208, 208, 204, 79, 67, 15},
        [222] = {208, 208, 208, 208, 204, 79, 103, 0},
        [223] = {208, 208, 208, 208, 204, 82, 208, 208},
        [224] = {208, 208, 208, 208, 206, 0, 0, 0},
        [225] = {208, 208, 208, 208, 206, 49, 208, 208},
        [226] = {208, 208, 208, 208, 208, 0, 208, 208},
        [227] = {208, 208, 208, 208, 208, 2, 110, 1},
        [228] = {208, 208, 208, 208, 208, 110, 0, 0},
        [229] = {208, 208, 208, 208, 208, 128, 78, 0},
        [230] = {208, 208, 208, 208, 208, 166, 208, 191},
        [231] = {208, 208, 208, 208, 208, 177, 79, 0},
        [232] = {208, 208, 208, 208, 208, 177, 79, 80},
        [233] = {208, 208, 208, 208, 208, 177, 88, 170},
        [234] = {208, 208, 208, 208, 208, 183, 0, 0},
        [235] = {208, 208, 208, 208, 208, 183, 208, 208},
        [236] = {208, 208, 208, 208, 208, 189, 79, 89},
        [237] = {208, 208, 208, 208, 208, 206, 0, 0},
        [238] = {208, 208, 208, 208, 208, 206, 191, 0},
        [239] = {208, 208, 208, 208, 208, 206, 208, 208},
        [240] = {208, 208, 208, 208, 208, 207, 76, 79},
        [241] = {208, 208, 208, 208, 208, 207, 92, 82},
        [242] = {208, 208, 208, 208, 208, 207, 98, 49},
        [243] = {208, 208, 208, 208, 208, 208, 49, 208},
        [244] = {208, 208, 208, 208, 208, 208, 79, 79},
        [245] = {208, 208, 208, 208, 208, 208, 80, 208},
        [246] = {208, 208, 208, 208, 208, 208, 102, 0},
        [247] = {208, 208, 208, 208, 208, 208, 105, 108},
        [248] = {208, 208, 208, 208, 208, 208, 166, 0},
        [249] = {208, 208, 208, 208, 208, 208, 166, 2},
        [250] = {208, 208, 208, 208, 208, 208, 166, 30},
        [251] = {208, 208, 208, 208, 208, 208, 183, 0},
        [252] = {208, 208, 208, 208, 208, 208, 189, 79},
        [253] = {208, 208, 208, 208, 208, 208, 191, 0},
        [254] = {208, 208, 208, 208, 208, 208, 194, 208},
        [255] = {208, 208, 208, 208, 208, 208, 197, 79},
        [256] = {208, 208, 208, 208, 208, 208, 201, 0},
        [257] = {208, 208, 208, 208, 208, 208, 201, 49},
        [258] = {208, 208, 208, 208, 208, 208, 201, 201},
        [259] = {208, 208, 208, 208, 208, 208, 206, 0},
        [260] = {208, 208, 208, 208, 208, 208, 208, 0},
        [261] = {208, 208, 208, 208, 208, 208, 208, 15},
        [262] = {208, 208, 208, 208, 208, 208, 208, 110},
        [263] = {208, 208, 208, 208, 208, 208, 208, 137},
        [264] = {208, 208, 208, 208, 208, 208, 208, 166},
        [265] = {208, 208, 208, 208, 208, 208, 208, 191},
        [266] = {208, 208, 208, 208, 208, 208, 208, 206},
        [267] = {208, 208, 208, 208, 208, 208, 208, 208},
        [268] = {208, 208, 208, 208, 208, 208, 208, 212},
        [269] = {208, 208, 208, 208, 208, 208, 208, 223},
        [270] = {208, 208, 208, 208, 208, 230, 237, 208},
        [271] = {208, 208, 208, 220, 208, 208, 208, 208},
        [272] = {208, 208, 208, 226, 208, 229, 208, 208},
        [273] = {208, 208, 212, 208, 214, 208, 208, 208},
        [274] = {208, 208, 213, 208, 208, 208, 234, 209},
        [275] = {208, 208, 216, 208, 208, 208, 208, 208},
        [276] = {208, 208, 218, 208, 228, 226, 208, 212},
        [277] = {208, 208, 235, 208, 208, 208, 185, 208},
        [278] = {208, 210, 231, 245, 208, 191, 0, 0},
        [279] = {208, 215, 221, 208, 208, 208, 208, 208},
        [280] = {208, 222, 257, 257, 257, 208, 208, 224},
        [281] = {208, 257, 248, 208, 208, 208, 208, 209},
        [282] = {211, 226, 208, 208, 208, 234, 208, 208},
        [283] = {214, 208, 208, 208, 208, 183, 208, 208},
        [284] = {216, 210, 214, 208, 208, 224, 227, 225},
        [285] = {238, 257, 257, 257, 257, 257, 257, 257},
        [286] = {242, 0, 257, 257, 257, 257, 257, 247},
        [287] = {242, 0, 257, 257, 257, 257, 257, 257},
        [288] = {253, 214, 244, 0, 208, 219, 217, 239},
        [289] = {255, 0, 208, 208, 208, 208, 208, 208},
        [290] = {257, 208, 257, 257, 257, 257, 257, 257},
        [291] = {257, 232, 239, 0, 252, 0, 0, 0},
        [292] = {257, 246, 248, 208, 257, 257, 236, 257},
        [293] = {257, 249, 257, 257, 257, 257, 257, 257},
        [294] = {257, 255, 257, 257, 257, 257, 257, 242},
        [295] = {257, 257, 208, 208, 208, 208, 208, 208},
        [296] = {257, 257, 243, 257, 255, 247, 194, 208},
        [297] = {257, 257, 248, 208, 257, 257, 257, 257},
        [298] = {257, 257, 252, 0, 0, 0, 257, 247},
        [299] = {257, 257, 255, 35, 257, 257, 257, 257},
        [300] = {257, 257, 257, 240, 257, 257, 257, 257},
        [301] = {257, 257, 257, 255, 0, 0, 0, 0},
        [302] = {257, 257, 257, 255, 257, 257, 257, 257},
        [303] = {257, 257, 257, 257, 208, 208, 208, 208},
        [304] = {257, 257, 257, 257, 234, 208, 208, 208},
        [305] = {257, 257, 257, 257, 234, 213, 254, 257},
        [306] = {257, 257, 257, 257, 242, 0, 257, 239},
        [307] = {257, 257, 257, 257, 247, 0, 208, 208},
        [308] = {257, 257, 257, 257, 247, 0, 257, 257},
        [309] = {257, 257, 257, 257, 257, 241, 257, 256},
        [310] = {257, 257, 257, 257, 257, 257, 233, 31},
        [311] = {257, 257, 257, 257, 257, 257, 239, 0},
        [312] = {257, 257, 257, 257, 257, 257, 242, 0},
        [313] = {257, 257, 257, 257, 257, 257, 247, 0},
        [314] = {257, 257, 257, 257, 257, 257, 257, 247},
        [315] = {257, 257, 257, 257, 257, 257, 257, 250},
        [316] = {257, 257, 257, 257, 257, 257, 257, 251},
        [317] = {257, 257, 257, 257, 257, 257, 257, 252},
        [318] = {257, 257, 257, 257, 257, 257, 257, 253},
        [319] = {257, 257, 257, 257, 257, 257, 257, 255},
        [320] = {257, 257, 257, 257, 257, 257, 257, 256},
        [321] = {257, 257, 257, 257, 257, 257, 257, 257},
};
static const uint16_t widths_2[][8] = {
        [0]  = {0, 0, 0, 0, 0, 0, 0, 0},
        [1]  = {0, 0, 0, 0, 54, 54, 54, 52},
        [2]  = {0, 0, 0, 0, 321, 321, 321, 321},
        [3]  = {0, 0, 0, 9, 0, 0, 0, 0},
        [4]  = {0, 0, 199, 169, 213, 151, 202, 100},
        [5]  = {0, 2, 253, 0, 0, 0, 0, 0},
        [6]  = {0, 7, 0, 0, 0, 0, 0, 0},
        [7]  = {0, 12, 0, 0, 226, 119, 0, 0},
        [8]  = {0, 267, 195, 0, 267, 106, 21, 14},
        [9]  = {13, 266, 6, 267, 267, 267, 267, 267},
        [10] = {17, 204, 165, 16, 267, 267, 155, 267},
        [11] = {22, 154, 267, 183, 161, 51, 222, 233},
        [12] = {29, 38, 31, 49, 30, 42, 26, 39},
        [13] = {35, 130, 32, 109, 190, 135, 64, 120},
        [14] = {50, 0, 0, 0, 0, 0, 0, 0},
        [15] = {55, 57, 105, 0, 0, 0, 0, 0},
        [16] = {60, 296, 267, 265, 37, 304, 266, 28},
        [17] = {66, 46, 87, 45, 41, 47, 25, 124},
        [18] = {76, 61, 74, 91, 73, 111, 75, 79},
        [19] = {84, 137, 210, 216, 257, 180, 171, 0},
        [20] = {86, 128, 101, 262, 0, 0, 0, 0},
        [21] = {95, 260, 77, 48, 223, 129, 69, 80},
        [22] = {102, 27, 148, 3, 0, 0, 0, 0},
        [23] = {115, 182, 205, 8, 198, 0, 261, 168},
        [24] = {142, 114, 167, 0, 126, 63, 149, 0},
        [25] = {153, 262, 112, 256, 206, 82, 235, 146},
        [26] = {155, 133, 134, 0, 156, 310, 306, 287},
        [27] = {158, 162, 267, 264, 96, 267, 164, 19},
        [28] = {172, 0, 125, 209, 40, 43, 0, 0},
        [29] = {184, 192, 11, 15, 70, 59, 85, 44},
        [30] = {189, 177, 145, 0, 67, 65, 72, 221},
        [31] = {215, 147, 139, 132, 267, 267, 267, 53},
        [32] = {224, 150, 267, 267, 267, 267, 267, 268},
        [33] = {229, 98, 247, 89, 33, 218, 267, 211},
        [34] = {232, 185, 93, 117, 321, 303, 267, 267},
        [35] = {234, 241, 203, 246, 267, 267, 263, 1},
        [36] = {236, 0, 13, 249, 0, 0, 0, 0},
        [37] = {237, 0, 0, 0, 0, 0, 0, 0},
        [38] = {239, 208, 267, 242, 220, 227, 186, 127},
        [39] = {244, 78, 231, 144, 196, 0, 0, 0},
        [40] = {255, 62, 244, 68, 0, 0, 240, 81},
        [41] = {262, 207, 0, 18, 245, 113, 166, 0},
        [42] = {267, 94, 0, 10, 267, 187, 0, 0},
        [43] = {267, 121, 0, 0, 0, 0, 0, 0},
        [44] = {267, 136, 248, 250, 214, 0, 0, 0},
        [45] = {267, 140, 141, 83, 170, 197, 194, 258},
        [46] = {267, 163, 300, 313, 321, 321, 321, 298},
        [47] = {267, 176, 200, 103, 118, 108, 267, 267},
        [48] = {267, 230, 138, 0, 0, 0, 0, 0},
        [49] = {267, 238, 267, 267, 267, 99, 0, 0},
        [50] = {267, 267, 34, 262, 160, 173, 252, 58},
        [51] = {267, 267, 97, 267, 243, 188, 152, 88},
        [52] = {267, 267, 201, 175, 226, 212, 0, 0},
        [53] = {267, 267, 219, 267, 267, 267, 267, 157},
        [54] = {267, 267, 267, 107, 267, 104, 0, 0},
        [55] = {267, 267, 267, 256, 225, 217, 71, 228},
        [56] = {267, 267, 267, 267, 54, 56, 24, 267},
        [57] = {267, 267, 267, 267, 179, 116, 254, 110},
        [58] = {267, 267, 267, 267, 259, 178, 0, 0},
        [59] = {267, 267, 267, 267, 267, 20, 168, 131},
        [60] = {267, 267, 267, 267, 267, 267, 193, 0},
        [61] = {267, 267, 267, 267, 267, 267, 267, 267},
        [62] = {267, 267, 267, 267, 271, 277, 181, 143},
        [63] = {267, 267, 267, 267, 272, 267, 267, 270},
        [64] = {275, 281, 276, 284, 282, 279, 274, 267},
        [65] = {283, 267, 174, 36, 159, 235, 278, 5},
        [66] = {286, 291, 0, 0, 305, 316, 297, 292},
        [67] = {302, 290, 321, 319, 321, 321, 321, 321},
        [68] = {309, 37, 299, 321, 23, 321, 294, 308},
        [69] = {320, 285, 321, 315, 318, 280, 273, 269},
        [70] = {321, 295, 321, 288, 267, 251, 267, 191},
        [71] = {321, 321, 293, 289, 267, 267, 267, 267},
        [72] = {321, 321, 321, 312, 0, 0, 0, 0},
        [73] = {321, 321, 321, 314, 0, 0, 0, 0},
        [74] = {321, 321, 321, 321, 122, 92, 267, 90},
        [75] = {321, 321, 321, 321, 301, 4, 321, 321},
        [76] = {321, 321, 321, 321, 321, 321, 307, 123},
        [77] = {321, 321, 321, 321, 321, 321, 321, 267},
        [78] = {321, 321, 321, 321, 321, 321, 321, 311},
        [79] = {321, 321, 321, 321, 321, 321, 321, 317},
        [80] = {321, 321, 321, 321, 321, 321, 321, 321},
};
static const uint8_t widths_3[][8] = {
        [0] = {0, 0, 0, 0, 0, 0, 0, 0},          [1] = {0, 0, 0, 0, 2, 74, 59, 16},
        [2] = {0, 0, 0, 0, 61, 41, 0, 8},        [3] = {0, 0, 61, 43, 0, 0, 0, 0},
        [4] = {1, 0, 0, 0, 0, 0, 0, 0},          [5] = {9, 56, 51, 11, 29, 12, 17, 13},
        [6] = {10, 63, 32, 64, 61, 62, 38, 46},  [7] = {14, 0, 0, 0, 54, 0, 5, 22},
        [8] = {18, 28, 40, 39, 36, 20, 24, 3},   [9] = {27, 4, 52, 58, 23, 19, 44, 7},
        [10] = {34, 45, 61, 50, 25, 30, 31, 57}, [11] = {55, 42, 47, 53, 61, 15, 0, 0},
        [12] = {61, 60, 49, 0, 0, 0, 0, 0},      [13] = {61, 61, 37, 0, 0, 0, 0, 0},
        [14] = {65, 66, 69, 70, 26, 6, 0, 0},    [15] = {68, 67, 80, 80, 80, 80, 80, 80},
        [16] = {75, 73, 0, 0, 0, 0, 48, 0},      [17] = {80, 80, 71, 35, 21, 33, 80, 80},
        [18] = {80, 80, 80, 76, 0, 0, 0, 0},     [19] = {80, 80, 80, 78, 80, 72, 0, 0},
        [20] = {80, 80, 80, 80, 80, 80, 77, 80}, [21] = {80, 80, 80, 80, 80, 80, 80, 79},
        [22] = {80, 80, 80, 80, 80, 80, 80, 80},
};
static const uint8_t widths_4[][8] = {
        [0] = {0, 0, 0, 0, 0, 0, 0, 0},         [1] = {4, 0, 0, 0, 0, 0, 0, 0},
        [2] = {5, 10, 6, 15, 20, 22, 22, 22},   [3] = {9, 8, 12, 13, 3, 0, 2, 22},
        [4] = {19, 0, 0, 16, 0, 11, 7, 14},     [5] = {22, 22, 17, 22, 22, 18, 0, 1},
        [6] = {22, 22, 22, 22, 22, 22, 22, 21}, [7] = {22, 22, 22, 22, 22, 22, 22, 22},
};
static const uint8_t widths_5[][8] = {
        [0] = {0, 0, 0, 0, 0, 0, 0, 0},
        [1] = {0, 0, 0, 0, 1, 0, 0, 0},
        [2] = {2, 5, 3, 4, 7, 6, 7, 6},
};
static const uint8_t widths_6[] = {2, 0, 0, 1, 0};

static int8_t get_width(uint32_t rune) {
    uint8_t b6 = (rune & 07000000) >> 18;
    uint8_t b5 = (rune & 00700000) >> 15;
    uint8_t b4 = (rune & 00070000) >> 12;
    uint8_t b3 = (rune & 00007000) >> 9;
    uint8_t b2 = (rune & 00000700) >> 6;
    uint8_t b1 = (rune & 00000070) >> 3;
    uint8_t b0 = (rune & 00000007) >> 0;
    int     x  = widths_6[b6];
    x          = widths_5[x][b5];
    x          = widths_4[x][b4];
    x          = widths_3[x][b3];
    x          = widths_2[x][b2];
    x          = widths_1[x][b1];
    x          = widths_0[x][b0];
    return x;
}

size_t pn_rune_width(uint32_t rune) {
    if (rune >= 0x110000) {
        return 1;
    }
    int8_t w = get_width(rune);
    if (w == -1) {
        return 1;
    }
    return w;
}

size_t pn_str_width(const char* data, size_t size) {
    size_t total = 0;
    for (size_t i = 0; i < size; i = pn_rune_next(data, size, i)) {
        total += pn_rune_width(pn_rune(data, size, i));
    }
    return total;
}

bool pn_isprint(uint32_t rune) {
    if (rune >= 0x110000) {
        return false;
    }
    return get_width(rune) != -1;
}
